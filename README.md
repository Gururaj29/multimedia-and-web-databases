# Multimedia and Web Databases Project - Phase 3

### About the project

The phase 3 of this project is experimenting with clustering, indexing and classfication and relevance feedback models. The tasks in this phase involve the feature models, similarity/distance functions, and latent space extraction algorithms developed in the previous phase.

# Multimedia and Web Databases Project - Phase 2

### About the project

This project is about extracting useful feature descriptors - color moments (mean, standard deviation, skewness), Histogram of Oriented Gradients (HOG), ResNet50 AvgPool, ResNet50 Layer3 and ResNet Fully Connected output layers. Used different dimensionality reduction techniques - `SVD`, `NNMF`, `CP`, `LDA`, `CP` and `K-means` on image feature descriptors, image-feature-label tensor, image-image similarity matrix and label-label similarity matrix to store 'k' latent features as `ls1`, `ls2`, `ls3` and `ls4` respectively. For tasks 7-10, we used these latent semantics to identify k most similar labels and images for given image ID/label/external image. We also have a task which creates a similarity graph for all image nodes and identifies k most significant images for a given label using personalized page rank algorithm.

### Code structure
 This repository contains three python files and three modules and three main internal packages and three repositories for `Data`, `Input` and `Outputs`:

 * util - This file contains all constants and utility methods which are used across this application
 * storage - used to generate all feature descriptors and find k most similar images, all the input is used to this file using functions
 * cli - entrypoint package for this application. Runs a CLI with all arg subparsers for each task. cli.toml contains static data required for this cli.

 Packages: 
 * FeatureDescriptor/ 
    - create_label_vectors and create_label_feature_vectors are the scripts to generate all feature descriptors required for this application
    - color_moments, HOG, resnet_features and resnet_softmax_features contain method to generate respective feature descriptors for a given ID or an external. These methods are used in the application and also in the script
    - similarity_measures contains methods for different similarity measures used in this project   
 * DimensionalityReductionTechniques/ 
    - dimensionality_reduction_techniques - this contains a method which returns a class of DRT after performing the dimensionality reduction based on the input drt.
    - this module in this package contains class to perform different dimensionality reduction techniques - SVD, NNMF, LDA and K Means.
 * Tasks/ 
    - task_runner: this module is used in cli.py to call each of the task executors based on the CLI input
    - task_[0-11]: these modules executes respective task IDs
    - task_util: This module contains the utility method used across the tasks
 
### Output
After we run the program, all extracted images will be saved in `Data` folder and all the feature descriptors of images and labels, latent semantics, similarity matrices and task outputs will be saved in `Outputs` folder and preview of k most similar images/label will be shown for task 7-10. 'Data' and 'Outputs' have been deleted initially as they will be autogenerated once we running the program. `Outputs` folder containing all generated FD csv/txt files has been moved out of this repository. Query output screenshots also stored in the outer `Outputs` folder

### Hardware/Software Requirements
* Processor: Minimum 2 GHz
* Hard Drive: Minimum 3 GB
* RAM: Minimum 4 GB
* OS: Windows/Mac OSX
* Programming language: Python 3.9+

### How to run

* Install all dependencies - 
``` pip install requirements.txt```
* Pre-process the images data before running the CLI application. Run create_label_vectors and create_label_feature_vectors scripts to generate all the required feature descriptors in Outputs
* Use `python cli.py --help` to know the sub-commands for each task
```
$ python3 cli.py --help
usage: cli.py [-h] [-i | --interactive | --no-interactive] {task0,task1,task2,task3,task4,task5,task6,task7,task8,task9,task10,task11} ...

positional arguments:
  {task0,task1,task2,task3,task4,task5,task6,task7,task8,task9,task10,task11}
    task0               Finds k similar images based on feature descriptors of an existing image with image ID or an external image
    task1               Identifies and visualizes k relevant images for given label
    task2               Identifies k likely matching labels based on feature descriptors of existing/external image
    task3               Runs SVD/NNMF/LDA/k-means dimensionality reduction techniques on image feature descriptors
    task4               Runs CP decomposition on image-feature-label tensor
    task5               Runs SVD/NNMF/LDA/k-means dimensionality reduction techniques on label-label similarity matrix for given FD
    task6               Runs SVD/NNMF/LDA/k-means dimensionality reduction techniques on label-label similarity matrices for the given FD
    task7               Identifies and visualizes k similar images for an existing/external image
    task8               Identifies and lists k likely matching label for an existing/external image
    task9               Identifies and lists k likely matching label for a given label
    task10              Identifies and lists k most relevant for an existing/external image
    task11              Creates a similarity graph and identifies m most significant images for a given label

optional arguments:
  -h, --help            show this help message and exit
  -i, --interactive, --no-interactive
```


* Run `python cli.py --i` or `make run_interactive` to run interactive mode of this application
```
$ make run_interactive
Loading Feature Vectors...
Feature Vectors Loaded
Command >>> task5 --help
usage: Runs SVD/NNMF/LDA/k-means dimensionality reduction techniques on label-label similarity matrix for given FD

Implement a program which, (a) given one of the feature models and (b) a value k,
    – creates (and saves) a label-label similarity matrix,
    – performs a user selected dimensionality reduction technique (SVD, NNMF, LDA, k-means) on this label-label similarity matrix,
    – stores the latent semantics in a properly named output file
    – lists label-weight pairs, ordered in decreasing order of weights

optional arguments:
  -h, --help        show this help message and exit
  --feature_model   Feature descriptor to be used. Allowed options are: RESNET, CM, HOG, AvgPool, L3, FC
  --k               top-k latent semantics
  --drt             Chosen dimensionality reduction technique. Allowed options are: SVD, NNMF, LDA, kmeans
Command >>> task5 --feature_model HOG --k 5 --drt SVD
Loading label-label similarity matrix from file
Running dimensionality reduction technique: svd... 
Storing 5 latent features in output file... 
Label ID - weight pairs in the decreasing order:
     Object_ID   Weight
      Leopards 0.114918
   cougar_body 0.114123
    wheelchair 0.113851
      hedgehog 0.113645
   joshua_tree 0.113599
        barrel 0.113389
crocodile_head 0.113276
          ibis 0.113153
      wild_cat 0.112733
      platypus 0.112721
         pizza 0.112465
         Faces 0.112425
     hawksbill 0.112351
       gerenuk 0.112211
   water_lilly 0.112046
         ferry 0.111855
     crocodile 0.111786
       pyramid 0.111554
         llama 0.110915
          crab 0.110837
Command >>> 
```


* Alternatively, you can also run tasks using cli.py without the interactive mode - ```python cli.py task{task_id} [arguments]```
```
$ python3 cli.py task5 --feature_model HOG --k 5 --drt SVD
Loading Feature Vectors...
Feature Vectors Loaded
Loading label-label similarity matrix from file
Running dimensionality reduction technique: svd... 
Storing 5 latent features in output file... 
Label ID - weight pairs in the decreasing order:
     Object_ID   Weight
      Leopards 0.114918
   cougar_body 0.114123
    wheelchair 0.113851
      hedgehog 0.113645
   joshua_tree 0.113599
        barrel 0.113389
crocodile_head 0.113276
          ibis 0.113153
      wild_cat 0.112733
      platypus 0.112721
         pizza 0.112465
         Faces 0.112425
     hawksbill 0.112351
       gerenuk 0.112211
   water_lilly 0.112046
         ferry 0.111855
     crocodile 0.111786
       pyramid 0.111554
         llama 0.110915
          crab 0.110837
```
